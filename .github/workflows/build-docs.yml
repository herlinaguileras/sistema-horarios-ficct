name: Build Documentation PDF

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-docs:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install apt packages
        run: |
          sudo apt-get update
          sudo apt-get install -y plantuml graphviz pandoc wkhtmltopdf openjdk-17-jre-headless pwgen

      - name: Render PlantUML diagrams
        run: |
          # render all puml files under docs/diagrams (recursive)
          find docs/diagrams -name "*.puml" -print0 | xargs -0 -n1 plantuml -tpng || true

      - name: Run PowerShell build script
        shell: pwsh
        run: |
          ./scripts/build-docs-pdf.ps1

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: documentation-pdf
          path: docs/build/documentation.pdf
